{"version":3,"sources":["../../src/toby.es6"],"names":[],"mappings":"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","file":"toby.js","sourcesContent":["// toby.es6 - Front end code for Toby\r\n// Copyright (C) 2016 Frank Hale <frankhale@gmail.com>\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\nconst Toby = (function() {\r\n\r\n  _.mixin({\r\n    'pluckMany': (data,columns) => {\r\n      return _.map(data,_.partialRight(_.pick,columns));\r\n    },\r\n    'findByValues': (collection, property, values) => {\r\n      return _.filter(collection, function(item) {\r\n        return _.contains(values, item[property]);\r\n      });\r\n    }\r\n  });\r\n\r\n  let notificationTimeout = 3000;\r\n\r\n  class CommandInput extends React.Component {\r\n    constructor() {\r\n      super();\r\n      this.onCommandInputKeyUp = this.onCommandInputKeyUp.bind(this);\r\n      this.onCommandInputChanged = this.onCommandInputChanged.bind(this);\r\n\r\n      this.keys = {\r\n        Enter: 13,\r\n        Up: 38,\r\n        Down: 40\r\n      };\r\n\r\n      this.state = {\r\n        commandIndex: -1,\r\n        commandsEntered: []\r\n      };\r\n    }\r\n    componentDidMount() {\r\n      // Make sure the command input box width is a consistant width based on the\r\n      // width of the window.\r\n      const $commandText = $(\"#commandText\");\r\n\r\n      // this may need to be changed later if I have more rich UI's but basically\r\n      // this will make sure the command input is always focused, hopefully.\r\n      // $(commandText).on(\"blur\", () => {\r\n      //   $commandText.focus();\r\n      // });\r\n\r\n      this.setState({ commandText: $commandText });\r\n\r\n      function resizeCommandInput() {\r\n        $commandText.width(window.innerWidth - 50);\r\n      }\r\n\r\n      resizeCommandInput();\r\n\r\n      $(window).resize((e) => {\r\n        resizeCommandInput();\r\n      });\r\n    }\r\n    onCommandInputKeyUp(e) {\r\n      if(e.which === this.keys.Up) {\r\n        let commandIndex = (this.state.commandIndex === -1) ?\r\n                            this.state.commandsEntered.length - 1 :\r\n                            --this.state.commandIndex;\r\n\r\n        if(commandIndex < 0) {\r\n          commandIndex = 0;\r\n        }\r\n\r\n        this.setState({ commandIndex: commandIndex}, function() {\r\n          this.state.commandText.val(this.state.commandsEntered[commandIndex]);\r\n        });\r\n\r\n      } else if (e.which === this.keys.Down) {\r\n        let commandIndex = (this.state.commandIndex === -1) ? 0 : ++this.state.commandIndex;\r\n\r\n        if(commandIndex > this.state.commandsEntered.length) {\r\n          commandIndex = this.state.commandsEntered.length;\r\n        }\r\n\r\n        this.setState({ commandIndex: commandIndex }, function() {\r\n          this.state.commandText.val(this.state.commandsEntered[commandIndex]);\r\n        });\r\n\r\n      } else if(e.which === this.keys.Enter) {\r\n        const textEntered = this.state.commandText.val();\r\n        if(!(textEntered.length > 0)) return;\r\n\r\n        this.setState({\r\n          commandsEntered: _.uniq(this.state.commandsEntered.concat([textEntered])),\r\n          commandIndex: -1\r\n        }, function() {\r\n          if(this.props.onKeyEnter !== undefined) {\r\n            this.props.onKeyEnter(textEntered);\r\n          }\r\n        });\r\n      }\r\n    }\r\n    onCommandInputChanged(e) {\r\n      const textEntered = this.state.commandText.val();\r\n\r\n      if(this.props.onKeyChanged !== undefined) {\r\n        this.props.onKeyChanged(textEntered);\r\n      }\r\n    }\r\n    render() {\r\n      return (\r\n        <div id=\"commandContainer\" className=\"command-container\">\r\n          &gt;<input id=\"commandText\" className=\"command-input\" type=\"text\" onKeyUp={this.onCommandInputKeyUp} onChange={this.onCommandInputChanged} autoFocus placeholder=\"Search YouTube or your saved videos...\" />\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  class ContentPanel extends React.Component {\r\n    constructor() {\r\n      super();\r\n\r\n      this.state = {\r\n        data: [],\r\n        applyFilter: \"\"\r\n      };\r\n    }\r\n    componentWillReceiveProps(nextProps) {\r\n      if(nextProps.data !== undefined) {\r\n        this.setState({\r\n          data: nextProps.data,\r\n          applyFilter: (nextProps.applyFilter !== undefined) ? nextProps.applyFilter : \"\"\r\n        });\r\n      }\r\n    }\r\n    componentDidMount() {\r\n      var resizeHighlight = function() {\r\n        $(\".highlightRow\").css(\"width\", window.innerWidth - 25);\r\n        $(\".videoTitle\").css(\"width\", window.innerWidth - 200);\r\n      };\r\n\r\n      window.addEventListener(\"resize\", function(e) {\r\n        resizeHighlight();\r\n      });\r\n    }\r\n    render() {\r\n      // function markdownThisShit(d) {\r\n      //   const item = validator.escape(d);\r\n      //   return { __html: marked(item) };\r\n      // }\r\n\r\n      let highlightRowStyle = {\r\n        width: window.innerWidth - 25\r\n      };\r\n\r\n      let videoTitleStyle = {\r\n        width: window.innerWidth - 200\r\n      };\r\n\r\n      return (\r\n        <div className=\"content-panel\">\r\n        {\r\n          this.state.data.map((d, i) => {\r\n            //return <div dangerouslySetInnerHTML={markdownThisShit(d)} key={i}></div>;\r\n            return (\r\n              <div className=\"highlightRow\" style={highlightRowStyle} onClick={d.playVideo.bind(this, d)}>\r\n                <div className={\"alignDiv videoThumbnail \" + this.state.applyFilter}><img src={d.thumbnail}></img></div>\r\n                <div className=\"alignDiv videoTitle\" style={videoTitleStyle}>{d.title}</div>\r\n              </div>\r\n            );\r\n          })\r\n        }\r\n        </div>\r\n      )\r\n    }\r\n  }\r\n\r\n  class VideoAddedNotification extends React.Component {\r\n    constructor() {\r\n      super();\r\n\r\n      this.state = this.initialState();\r\n    }\r\n    initialState() {\r\n      return {\r\n        message: \"\",\r\n        notificationStyle: {\r\n          display: \"none\"\r\n        }\r\n      };\r\n    }\r\n    componentWillReceiveProps(nextProps) {\r\n      if(nextProps.message !== undefined && nextProps.message.length > 0) {\r\n        this.setState({\r\n          message: nextProps.message,\r\n          notificationStyle: {\r\n            display: \"block\"\r\n          }\r\n        }, function() {\r\n          //console.log(`message set to: ${this.state.message}`);\r\n          setTimeout(function() {\r\n            this.setState(this.initialState);\r\n          }.bind(this), notificationTimeout);\r\n        }.bind(this));\r\n      }\r\n    }\r\n    render() {\r\n      return (\r\n        <div className=\"videoAddedNotification\" style={this.state.notificationStyle}>{this.state.message}</div>\r\n      );\r\n    }\r\n  }\r\n\r\n  class AppUI extends React.Component {\r\n    constructor() {\r\n      super();\r\n\r\n      this.onCommandEntered = this.onCommandEntered.bind(this);\r\n      this.onCommandChanged = this.onCommandChanged.bind(this);\r\n\r\n      this.state = {\r\n        commands: [],\r\n        searchResults: [],\r\n        videoInfo: {},\r\n        videoAddedNotification: \"\"\r\n      };\r\n    }\r\n    onCommandEntered(searchTerm) {\r\n      $.ajax({\r\n        url: `/api/search/${encodeURIComponent(searchTerm)}`,\r\n        cache: false\r\n      })\r\n      .done(function(data) {\r\n        let commands = this.state.commands;\r\n        commands.push(searchTerm);\r\n\r\n        this.state.player.stopVideo();\r\n        $(\"#player\").css(\"display\", \"none\");\r\n        $.ajax({ type: \"POST\", url: `/api/resetWindowTitleToDefault` });\r\n\r\n        this.setState({\r\n          commands: commands,\r\n          searchResults: this.buildResults(data)\r\n        });\r\n      }.bind(this));\r\n    }\r\n    onCommandChanged(command) {\r\n      if(!(command.length > 0)) {\r\n        this.setState({\r\n          searchResults: []\r\n        });\r\n\r\n        this.state.player.stopVideo();\r\n        $(\"#player\").css(\"display\", \"none\");\r\n        $.ajax({ type: \"POST\", url: `/api/resetWindowTitleToDefault` });\r\n\r\n        return;\r\n      }\r\n    }\r\n    componentDidMount() {\r\n      this.initKeyBindings();\r\n\r\n      var tag = document.createElement('script');\r\n      tag.src = \"https://www.youtube.com/iframe_api\";\r\n      var firstScriptTag = document.getElementsByTagName('script')[0];\r\n      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n\r\n      var player;\r\n      window.onYouTubeIframeAPIReady = function() {\r\n        player = new YT.Player('player', {\r\n          //videoId: '',\r\n          playerVars: { 'autoplay': 1, 'autohide': 1 },\r\n          events: {\r\n            onReady: onPlayerReady,\r\n            onStateChange: onPlayerStateChange\r\n          }\r\n        });\r\n\r\n        $(window.frames[0].document).on('keydown', function (e) {\r\n            $(top.document).trigger('keydown', e);\r\n        });\r\n\r\n        this.setState({\r\n          player: player\r\n        });\r\n\r\n      }.bind(this);\r\n\r\n      var onPlayerReady = function(e) {\r\n        $(window.frames[0].document).on(\"keydown\", function (e) {\r\n          $(top.document).trigger(e);\r\n        });\r\n\r\n        player.setVolume(30);\r\n      };\r\n\r\n      var onPlayerStateChange = function(e) {\r\n        let videoInfo = e.target.getVideoData();\r\n\r\n        if(videoInfo.title !== \"\" &&\r\n           (this.state.videoInfo.title === undefined ||\r\n           this.state.videoInfo.title !== videoInfo.title)) {\r\n          this.setState({\r\n            videoInfo: videoInfo\r\n          }, function() {\r\n            $.ajax({\r\n              type: \"POST\",\r\n              url: \"/api/title\",\r\n              data: {\r\n                title: videoInfo.title\r\n              }//,\r\n              //success: function(data) {\r\n              // console.log(data);\r\n              //}\r\n            });\r\n          });\r\n        }\r\n      }.bind(this);\r\n    }\r\n    initKeyBindings() {\r\n      $(document).on(\"keydown\", function(e) {\r\n        var keycode = e.keyCode || e.which;\r\n\r\n        if(keycode === 116) {\r\n          if(!(_.isEmpty(this.state.videoInfo))) {\r\n            //console.log(this.state.videoInfo);\r\n\r\n            $.ajax({\r\n              url: \"/api/add\",\r\n              type: \"POST\",\r\n              data: {\r\n                title: this.state.videoInfo.title,\r\n                ytid: this.state.videoInfo.video_id,\r\n                group: \"misc\" // <- making way for user selection\r\n              },\r\n              success: function(data) {\r\n                //console.log(data);\r\n                this.setState({\r\n                  videoAddedNotification: data.status\r\n                }, function() {\r\n                  setTimeout(function() {\r\n                    this.setState({ videoAddedNotification: \"\" });\r\n                  }.bind(this), notificationTimeout);\r\n                }.bind(this));\r\n              }.bind(this)\r\n            });\r\n          }\r\n        } else if(keycode === 117) {\r\n          //$(\".videoThumbnail\").css(\"-webkit-filter\", \"grayscale(1)\");\r\n          this.setState({\r\n            applyFilter: \"blackandwhite\"\r\n          });\r\n\r\n          $(\"#player\").contents().find(\".html5-main-video\").css(\"-webkit-filter\", \"grayscale(1)\");\r\n        } else if(keycode === 118) {\r\n          //$(\".videoThumbnail\").css(\"-webkit-filter\", \"saturate(2.5)\");\r\n          this.setState({\r\n            applyFilter: \"saturate\"\r\n          });\r\n\r\n          $(\"#player\").contents().find(\".html5-main-video\").css(\"-webkit-filter\", \"saturate(2.5)\");\r\n        } else if(keycode === 119) {\r\n          //$(\".videoThumbnail\").css(\"-webkit-filter\", \"sepia(1)\");\r\n          this.setState({\r\n            applyFilter: \"sepia\"\r\n          });\r\n\r\n          $(\"#player\").contents().find(\".html5-main-video\").css(\"-webkit-filter\", \"sepia(1)\");\r\n        } else if(keycode === 120) {\r\n          //$(\".videoThumbnail\").css(\"-webkit-filter\", \"\");\r\n\r\n          this.setState({\r\n            applyFilter: \"\"\r\n          });\r\n\r\n          $(\"#player\").contents().find(\".html5-main-video\").css(\"-webkit-filter\", \"\");\r\n        }\r\n      }.bind(this));\r\n    }\r\n    buildResults(data) {\r\n      var results = [];\r\n\r\n      _.forEach(data, function(v) {\r\n\r\n        // Image thumbnail URL looks like this:\r\n        //\r\n        // https://i.ytimg.com/vi/YTID/default.jpg\r\n        // https://i.ytimg.com/vi/YTID/mqdefault.jpg\r\n        // https://i.ytimg.com/vi/YTID/hqdefault.jpg\r\n\r\n        results.push({\r\n          player: this.state.player,\r\n          playVideo: this.playVideo.bind(this),\r\n          title: v.title,\r\n          ytid: v.ytid,\r\n          thumbnail: `https://i.ytimg.com/vi/${v.ytid}/default.jpg`\r\n        });\r\n      }.bind(this));\r\n\r\n      return results;\r\n    }\r\n    playVideo(video) {\r\n      this.state.player.loadVideoById(video.ytid);\r\n      //this.state.player.setVolume(30);\r\n\r\n      $(\"#player\").css(\"display\", \"block\");\r\n\r\n      //document.getElementById(\"player\").scrollIntoView(true);\r\n      $('html, body').animate({ scrollTop: $(\"#player\").offset().top }, 250);\r\n\r\n      $.ajax({\r\n        type: \"POST\",\r\n        url: \"/api/title\",\r\n        data: { title: video.title}\r\n      });\r\n\r\n      $.ajax({\r\n        url: \"/api/add\",\r\n        type: \"POST\",\r\n        data: {\r\n          title: video.title,\r\n          ytid: video.ytid,\r\n          group: \"Recently Played\" // recently played group\r\n        }\r\n      });\r\n    }\r\n    render() {\r\n      return (\r\n        <div>\r\n          <VideoAddedNotification message={this.state.videoAddedNotification} />\r\n          <CommandInput onKeyEnter={this.onCommandEntered} onKeyChanged={this.onCommandChanged} />\r\n          <ContentPanel data={this.state.searchResults} applyFilter={this.state.applyFilter} />\r\n          <div id=\"player\"></div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  return {\r\n    init: function() {\r\n      ReactDOM.render(<AppUI />, document.getElementById(\"ui\"));\r\n    }\r\n  }\r\n})();\r\n\r\n$(document).ready(function() {\r\n  Toby.init();\r\n});\r\n"]}